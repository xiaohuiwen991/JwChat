
<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<meta charset="UTF-8">
<head>
<title>用户注册</title>
<link rel="icon" href="javascript:void(0)/favicon.ico" type="image/icon"/>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black"/>
<meta name="format-detection" content="telephone=no"/>
<link rel="stylesheet" href="../css/common.css"/>
<script src="../js/require.2.1.9-jquery.2.0.3-underscore.1.5.2-backbone.1.0.0.js"></script>
<style type="text/css">
    .geetest {
        display: none;
        position: fixed;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
    }

    .gt_bg {
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: gray;
        opacity: 0.7;
    }

    .geetest .gt_wrap {
        width: 300px;
        margin: 10px auto;
        text-align: center;
        background-color: #fff;
        z-index: 2;
        position: relative;
    }

    .gt_wrapper {
        margin: 0 auto;
    }

    .geetest .gt_wrap .gt_top {
        padding: 0 8px;
        height: 44px;
        z-index: 1;
        position: relative;
        text-align: center;
        font-weight: 500;
    }

    .geetest .gt_wrap .title {
        line-height: 45px;
        width: 200px;
        margin: 0 auto;
    }

    .goback {
        position: absolute;
        left: .5rem;
        color: #fff;
        font-size: 1rem;
    }

    input.check::-webkit-input-placeholder {
        /* placeholder颜色  */
        color: red;
    }

    p.error {
        margin-left: 30px;
        color: red;
    }
</style>
</head>
<body>
<div class="m_wrap">
    <div class="m_header">
        <a href="javascript:void(0);" class="goback">返回</a>
        用户注册
        <a class="m_header_refresh J_refresh" href="javascript:void(0);"></a></div>
    <br/>
    <br/>
    <form id="login-form" name="pop-form-login" >
        
        <input type="hidden" name="appkey" value="">

        <div class="mr_b25 m_input_wrap width90">
            <input class="m_input m_name" type="text" id="email_input" autocomplete="on" placeholder="请输入邮箱或手机号码" name="userName">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="email_input"></a>
            <p class="error hide" id="errorMessage"><font>账号已经存在请重新输入!</font></p>
        </div>
        <div class="mr_b25 m_input_wrap width90">
            <input class="m_input m_pwd J_pwd" id="password1_input" type="password" placeholder="请输入登录密码" name="password1">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="password1_input"></a>
        </div>
        <div class="mr_b25 m_input_wrap width90">
            <input class="m_input m_pwd J_pwd" id="password2_input" type="password" placeholder="请再次输入登录密码" name="password2">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="password2_input"></a>
            <p class="error hide" id="errorPassword"><font>两次密码输入不相同,请检查您输入的密码!</font></p>
        </div>
        <div class="mr_b25 m_input_wrap width90">
            <input class="m_name m_input" id="question1_input" type="text" placeholder="请输入安全问题一" name="question1">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="question1_input"></a>
        </div>
        <div class="mr_b25 m_input_wrap width90">
            <input class="m_name m_input" id="answer1_input" type="text" placeholder="请输入安全问题答案一" name="answer1">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="answer1_input"></a>
        </div>
        <div class="mr_b25 m_input_wrap width90">
            <input class="m_name m_input" id="question2_input" type="text" placeholder="请输入安全问题二" name="question2">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="question2_input"></a>
        </div>
        <div class="mr_b25 m_input_wrap width90">
            <input class="m_name m_input" id="answer2_input" type="text" placeholder="请输入安全问题答案二" name="answer2">
            <a href="javascript:void(0);" class="J_input_reset m_reset_btn" param="answer2_input"></a>
        </div>
        <div class="geetest">
            <div class="gt_bg"></div>
            <div class="gt_wrap">
                <div class="gt_top">
                    <a class="gt_exit" id="gt_close" href="javascript:void(0);"></a>

                    <div class="title">请拖动按钮通过验证</div>
                </div>
                <script type="text/javascript" src="http://api.geetest.com/get.php?gt=f43ff6668a26e10f745d87e1a7b5e731&width=300" async></script>
            </div>
        </div>
        <div class="mr_b15">
            <input class="m_button m_submit" readonly="readonly" value="提交">
        </div>
    </form>
    <div class="external">
        <div class="ex-wrap ex-href">
        </div>
    </div>
</div>
<script type="text/javascript">
    var device = (function () {
        var a;
        return function () {
            if (a) {
                return a;
            }
            a = {};
            var b = {isIPAD: "ipad", isIPHONE: "iphone", isIPOD: "ipod", isAndroid: "android"}, c;
            var ua = navigator.userAgent.toLowerCase();
            for (c in b) {
                a[c] = -1 !== ua.indexOf(b[c]) ? true : false;
            }
            a.isIOS = a.isIPAD || a.isIPHONE || a.isIPOD;
            return a;
        }
    })();

    //建立ios与native通信桥梁
    var ios_webview_bridge;
    document.addEventListener('WebViewJavascriptBridgeReady', function onBridgeReady(event) {
        ios_webview_bridge = event.bridge;
        ios_webview_bridge.init(function (message, responseCallback) {
            responseCallback(message);
        });
    }, false);
    function iosSendMessage(data, callback) {
        try {
            if (!ios_webview_bridge) {
                setTimeout(function () {
                    iosSendMessage(data, callback);
                }, 40);
                return false;
            }
            ios_webview_bridge.send(data, function responseCallback(responseData) {
                callback && callback(responseData);
            });
        } catch (e) {}
    }

    var appKey = '';
    var isStageAPP = false;

    if (appKey == '10211') {
        isStageAPP = true;
    }

    var isTrue = false;
    var referrer = '';
    $('#email_input').focus(function(){
        if($('#errorMessage').attr('class').indexOf('hide')==-1){
            $('#errorMessage').addClass('hide')
        }

    }),$('#password2_input').focus(function(){
        if($('#errorPassword').attr('class').indexOf('hide')==-1){
            $('#errorPassword').addClass('hide')
        }

    });
    $('.m_reset_btn').click(function(){
        var id = this.getAttribute('param');
        document.getElementById(id).value = '';
    }),$('.goback').click(function(){
        window.location.href = "login.htm";
    }),$('.m_submit').click(function(){
        var email = $('#email_input').val().trim();
        var password1 = $('#password1_input').val().trim();
        var password2 = $('#password2_input').val().trim();
        var question1 = $('#question1_input').val().trim();
        var answer1 = $('#answer1_input').val().trim();
        var question2 = $('#question2_input').val().trim();
        var answer2 = $('#answer2_input').val().trim();
        isTrue = false;
        if(email==''||email==null){
            check('email_input');
        }
        if(password1==''||password1==null){
            check('password1_input');
        }
        if(password2==''||password2==null){
            check('password2_input');
        }
        if(password2!=password1){
            $('#errorPassword').removeClass('hide');
            return;
        }
        if(question1==''||question1==null){
            check('question1_input');
        }
        if(answer1==''||answer1==null){
            check('answer1_input');
        }
        if(question2==''||question2==null){
            check('question2_input');
        }
        if(answer2==''||answer2==null){
            check('answer2_input');
        }
        if(isTrue) return;
        window.localStorage.setItem("register",$('#login-form').serialize());
        $.ajax({
            type: "post",
            dataType: "json",
            url: "http://127.0.0.1:8040/WeChat/wx/business/WeChart/check",
            data:$('#login-form').serialize(),
            success: function (msg) {
                console.log(msg)
                if(msg.data!=null){
                    if(msg.data==0) {
                        window.location.href = "userdata.htm";
                    } else {
                        $('#errorMessage').removeClass('hide');
                    }
                }
            }
        });

    });

    function check(id){
        var text=document.getElementById(id).value;
        if(text.trim()==''||text.trim()==null){
            document.getElementById(id).value = '';
            $('#'+id).addClass('check');
            isTrue = true;
        }
    }

    var cpro_id = "u2671677";
    $(document).ready(function () {
        if (referrer) {
            $('.goback').attr('href', referrer);
        }
    });
</script>
</body>
</html>